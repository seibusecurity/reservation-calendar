<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>予約カレンダー</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; text-align: center; padding: 10px; }
    .clickable { cursor: pointer; color: blue; }
    .reserved { color: red; }
    .form-container { display: none; margin-bottom: 20px; }
    .form-container input { display: block; margin: 5px 0; }
    .admin-toggle { margin-bottom: 20px; }
    .admin-panel { display: none; border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
    .notice { font-size: 0.9em; color: #666; margin-top: 10px; }
    .cancel-btn { margin-left: 10px; color: red; cursor: pointer; }
  </style>
</head>
<body>
  <h1>予約カレンダー</h1>

  <!-- 予約手順の説明 -->
  <div id="reservationInstructions">
    <h2>予約の手順</h2>
    <ol>
      <li><strong> カレンダーで予約したい日付を選択してください。</strong> 青の「〇」表示のある日が予約可能です。</li>
      <li><strong> 予約フォームにお名前、電話番号、メールアドレスを入力してください。</strong> 必須項目です。</li>
      <li><strong> 「予約を確定する」ボタンをクリックして、予約を送信してください。</strong> 予約が仮確定されます。</li>
      <li><strong> 予約の確定については、担当者からメールまたはお電話でご連絡いたします。</strong></li>
    </ol>
  </div>

  <div class="admin-toggle">
    <button onclick="toggleAdminMode()">管理モード切り替え</button>
    <input type="password" id="adminPass" placeholder="管理パスワード（4桁）" maxlength="4">
    <span id="adminStatus">現在: 通常モード</span>
  </div>

  <div id="adminPanel" class="admin-panel">
    <h2>予約一覧</h2>
    <ul id="reservationList"></ul>
  </div>

  <label for="month">月選択:</label>
  <select id="month"></select>
  <select id="year"></select>
  <button onclick="updateCalendar()">表示</button>

  <table id="calendar"></table>

  <div class="form-container" id="reservationForm">
    <h2>予約情報の入力</h2>
    <p id="selectedDateDisplay"></p>
    <input type="text" id="name" placeholder="お名前" required>
    <input type="tel" id="phone" placeholder="電話番号" required>
    <input type="email" id="email" placeholder="メールアドレス" required>
    <button onclick="submitReservation()">予約を確定する</button>
    <p class="notice">※こちらの予約は仮予約となります。予約の確定につきましては登録いただいたメールアドレスもしくは電話番号宛に連絡をいたします。</p>
  </div>

  <script>
    const reservedDates = ["2025-04-02", "2025-04-05"];
    const reservations = {};
    let selectedDate = null;
    let adminMode = false;
    const adminPassword = "1135";

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    function generateCalendar(year, month) {
      const table = document.getElementById("calendar");
      table.innerHTML = "";
      const date = new Date(year, month - 1, 1);
      const daysInMonth = new Date(year, month, 0).getDate();

      let row = table.insertRow();
      for (let i = 0; i < daysInMonth; i++) {
        const currentDate = new Date(year, month - 1, i + 1);
        const formatted = formatDate(currentDate);
        const cell = row.insertCell();

        if (reservedDates.includes(formatted)) {
          cell.innerHTML = `${i + 1}日<br><span class="reserved">×</span>`;
        } else {
          cell.innerHTML = `${i + 1}日<br><span class="clickable">〇</span>`;
        }

        if (adminMode) {
          cell.style.cursor = "pointer";
          cell.onclick = () => {
            const index = reservedDates.indexOf(formatted);
            if (index > -1) {
              reservedDates.splice(index, 1);
              delete reservations[formatted];
            } else {
              reservedDates.push(formatted);
            }
            generateCalendar(year, month);
            updateReservationList();
          };
        } else if (!reservedDates.includes(formatted)) {
          cell.onclick = () => {
            selectedDate = formatted;
            document.getElementById("reservationForm").style.display = "block";
            document.getElementById("selectedDateDisplay").innerText = `選択した日付: ${formatted}`;
          };
        }

        if ((i + 1) % 7 === 0) row = table.insertRow();
      }
    }

    function updateCalendar() {
      const year = parseInt(document.getElementById("year").value);
      const month = parseInt(document.getElementById("month").value);
      document.getElementById("reservationForm").style.display = "none";
      generateCalendar(year, month);
      if (adminMode) updateReservationList();
    }

    function submitReservation() {
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();

      if (!name || !phone || !email) {
        alert("全ての項目を入力してください。");
        return;
      }

      reservedDates.push(selectedDate);
      if (!reservations[selectedDate]) reservations[selectedDate] = [];
      reservations[selectedDate].push({ name, phone, email });

      alert(`${selectedDate} に予約が完了しました。\n名前: ${name}\n電話: ${phone}\nメール: ${email}`);
      updateCalendar();
    }

    function toggleAdminMode() {
      const inputPass = document.getElementById("adminPass").value;
      if (inputPass === adminPassword) {
        adminMode = !adminMode;
        document.getElementById("adminStatus").innerText = adminMode ? "現在: 管理モード" : "現在: 通常モード";
        document.getElementById("adminPanel").style.display = adminMode ? "block" : "none";
        updateCalendar();
      } else {
        alert("パスワードが間違っています。");
      }
    }

    function updateReservationList() {
      const list = document.getElementById("reservationList");
      list.innerHTML = "";
      for (const date in reservations) {
        reservations[date].forEach((res, index) => {
          const item = document.createElement("li");
          item.textContent = `${date} - ${res.name}（${res.phone}, ${res.email}）`;

          const cancelBtn = document.createElement("span");
          cancelBtn.textContent = "[キャンセル]";
          cancelBtn.className = "cancel-btn";
          cancelBtn.onclick = () => {
            reservations[date].splice(index, 1);
            if (reservations[date].length === 0) {
              delete reservations[date];
              const dateIndex = reservedDates.indexOf(date);
              if (dateIndex !== -1) reservedDates.splice(dateIndex, 1);
            }
            updateCalendar();
          };

          item.appendChild(cancelBtn);
          list.appendChild(item);
        });
      }
    }

    function initSelectors() {
      const monthSelect = document.getElementById("month");
      const yearSelect = document.getElementById("year");
      for (let m = 1; m <= 12; m++) {
        const option = document.createElement("option");
        option.value = m;
        option.text = `${m}月`;
        monthSelect.appendChild(option);
      }

      const thisYear = new Date().getFullYear();
      for (let y = thisYear - 1; y <= thisYear + 2; y++) {
        const option = document.createElement("option");
        option.value = y;
        option.text = `${y}年`;
        yearSelect.appendChild(option);
      }

      monthSelect.value = 4;
      yearSelect.value = 2025;
    }

    initSelectors();
    generateCalendar(2025, 4);
  </script>
</body>
</html>
